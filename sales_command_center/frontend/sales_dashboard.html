<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .tab-active { border-bottom: 3px solid #3B82F6; color: #3B82F6; font-weight: 600; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .notification-badge {
            position: absolute; top: -8px; right: -8px; background: #EF4444;
            color: white; border-radius: 9999px; width: 20px; height: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: bold;
        }
        .metric-card { transition: transform 0.2s; }
        .metric-card:hover { transform: translateY(-2px); }
        .voice-recording { animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 380px;
            background: white;
            border-right: 2px solid #E5E7EB;
            z-index: 100;
            overflow-y: auto;
        }
        .main-content {
            margin-left: 380px;
        }
        .chat-messages {
            max-height: calc(100vh - 400px);
            overflow-y: auto;
        }
        .chart-container {
            height: 300px;
            position: relative;
        }
        .chart-container canvas {
            max-height: 300px !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <!-- AI Assistant Sidebar (Persistent) -->
    <div class="sidebar shadow-xl">
        <div class="p-6 border-b-2 border-blue-600 bg-gradient-to-r from-blue-600 to-indigo-700">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg">
                    <span class="text-2xl">ü§ñ</span>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">AI Assistant</h2>
                    <p class="text-xs text-blue-100">Always here to help</p>
                </div>
            </div>
            <button onclick="startVoiceQuery()" id="voiceBtn" class="w-full px-4 py-2 bg-white text-blue-700 rounded-lg hover:bg-blue-50 font-medium text-sm">
                üé§ Voice Command
            </button>
        </div>

        <!-- Chat Messages -->
        <div id="aiChatMessages" class="chat-messages p-4 bg-gray-50">
            <div class="text-center text-gray-500 text-sm">
                <p class="mb-2">üëã Welcome! Ask me anything:</p>
                <ul class="text-left mt-3 space-y-1 text-xs">
                    <li>‚Ä¢ "Show me pending orders today"</li>
                    <li>‚Ä¢ "Create order for Disney, 500 tablets"</li>
                    <li>‚Ä¢ "What's my pipeline for Q1?"</li>
                    <li>‚Ä¢ "Compare this month vs last month"</li>
                </ul>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 border-t border-gray-200 bg-white">
            <div class="flex gap-2 mb-2">
                <input type="text" id="aiQueryInput" placeholder="Ask anything..."
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                       onkeypress="if(event.key==='Enter') askAI()"/>
                <button onclick="askAI()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:opacity-90 font-medium text-sm">
                    Send
                </button>
            </div>
            <div class="flex flex-wrap gap-1">
                <button onclick="askQuick('How many orders today?')"
                        class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs hover:bg-blue-200">
                    Today's orders
                </button>
                <button onclick="askQuick('Pending > $100K')"
                        class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs hover:bg-green-200">
                    Large orders
                </button>
                <button onclick="askQuick('Regional performance')"
                        class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs hover:bg-purple-200">
                    Regions
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="p-4 border-t border-gray-200">
            <h3 class="text-xs font-bold text-gray-600 mb-2">QUICK ACTIONS</h3>
            <div class="space-y-2">
                <button onclick="startVoiceOrder()" class="w-full px-3 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:opacity-90 text-sm font-medium">
                    üé§ Create Order (Voice)
                </button>
                <button onclick="generateReport()" class="w-full px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 text-sm font-medium">
                    üìä Generate Report
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Navigation -->
        <nav class="bg-white shadow-lg border-b-2 border-blue-600 sticky top-0 z-50">
            <div class="max-w-full mx-auto px-6 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg">
                            <span class="text-white font-bold text-xl">S</span>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Sales Command Center</h1>
                            <p class="text-xs text-gray-600">Real-Time Sales Intelligence | <span id="currentDate"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <p class="text-xs text-gray-500">Today's Revenue</p>
                            <p class="text-2xl font-bold text-green-600" id="headerRevenue">$0</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-500">Q4 Progress</p>
                            <p class="text-2xl font-bold text-blue-600" id="headerQuarterProgress">0%</p>
                        </div>
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-full flex items-center justify-center text-white font-bold cursor-pointer">
                            <span id="userInitials">VP</span>
                        </div>
                    </div>
                </div>
                <!-- Tab Navigation - Tabs are configurable via TAB_CONFIG in JavaScript -->
                <div id="tabNavigation" class="flex gap-1 mt-4 border-b overflow-x-auto">
                    <button onclick="switchTab('clevel')" id="tab-clevel" class="px-4 py-2 text-sm tab-active whitespace-nowrap">
                        üìä C-level Overview
                    </button>
                    <button onclick="switchTab('sales')" id="tab-sales" class="px-4 py-2 text-sm hover:bg-gray-50 whitespace-nowrap">
                        üí∞ Sales
                    </button>
                    <button onclick="switchTab('procurement')" id="tab-procurement" class="px-4 py-2 text-sm hover:bg-gray-50 whitespace-nowrap">
                        üõí Procurement
                    </button>
                    <button onclick="switchTab('inventory')" id="tab-inventory" class="px-4 py-2 text-sm hover:bg-gray-50 relative whitespace-nowrap">
                        üì¶ Inventory <span class="notification-badge" id="inventoryNotif">0</span>
                    </button>
                    <button onclick="switchTab('finap')" id="tab-finap" class="px-4 py-2 text-sm hover:bg-gray-50 whitespace-nowrap">
                        üí≥ Fin - AP
                    </button>
                    <button onclick="switchTab('finar')" id="tab-finar" class="px-4 py-2 text-sm hover:bg-gray-50 whitespace-nowrap">
                        üíµ Fin - AR
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content Container -->
        <div class="max-w-full mx-auto px-6 py-6">

            <!-- C-LEVEL OVERVIEW TAB -->
            <div id="content-clevel" class="tab-content fade-in">
                <!-- Key Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Total Revenue (MTD)</h3>
                        <p class="text-3xl font-bold text-gray-800" id="totalRevenue">$0</p>
                        <p class="text-sm text-green-600 mt-1" id="revenueChange">‚Üë 0% vs last month</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Open Orders</h3>
                        <p class="text-3xl font-bold text-gray-800" id="openOrders">0</p>
                        <p class="text-sm text-blue-600 mt-1" id="openOrdersValue">$0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Cash Position</h3>
                        <p class="text-3xl font-bold text-gray-800" id="cashPosition">$0</p>
                        <p class="text-sm text-purple-600 mt-1" id="cashFlow">+$0 this week</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Inventory Value</h3>
                        <p class="text-3xl font-bold text-gray-800" id="inventoryValue">$0</p>
                        <p class="text-sm text-yellow-600 mt-1" id="inventoryTurnover">0x turnover</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Profit Margin</h3>
                        <p class="text-3xl font-bold text-gray-800" id="profitMargin">0%</p>
                        <p class="text-sm text-orange-600 mt-1" id="marginChange">‚Üì 0% vs target</p>
                    </div>
                </div>

                <!-- Charts and Details Row -->
                <div class="grid grid-cols-3 gap-6">
                    <!-- Revenue Trend Chart -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800">Revenue Trend</h3>
                            <select class="text-sm border rounded px-2 py-1" onchange="updateRevenueTrend(this.value)">
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="revenueTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- Department Performance -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Department Performance</h3>
                        <div class="chart-container">
                            <canvas id="regionalChart"></canvas>
                        </div>
                    </div>

                    <!-- Key Alerts -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Executive Alerts</h3>
                        <div id="topPerformers" class="space-y-3">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Critical Alerts -->
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üö® Critical Business Alerts</h3>
                    <div id="criticalAlerts" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- SALES TAB -->
            <div id="content-sales" class="tab-content hidden">
                <!-- Sales Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Orders Fulfilled Today</h3>
                        <p class="text-3xl font-bold text-gray-800" id="salesOrdersFulfilled">47</p>
                        <p class="text-sm text-green-600 mt-1">‚Üë 12% vs yesterday</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Orders Pending</h3>
                        <p class="text-3xl font-bold text-gray-800" id="salesOrdersPending">23</p>
                        <p class="text-sm text-yellow-600 mt-1">$450K value</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Pipeline Value</h3>
                        <p class="text-3xl font-bold text-gray-800" id="salesPipelineValue">$12.5M</p>
                        <p class="text-sm text-blue-600 mt-1">145 deals</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Win Rate</h3>
                        <p class="text-3xl font-bold text-gray-800" id="salesWinRate">42%</p>
                        <p class="text-sm text-purple-600 mt-1">‚Üì 3% vs last month</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Avg Deal Size</h3>
                        <p class="text-3xl font-bold text-gray-800" id="avgDealSize">$86K</p>
                        <p class="text-sm text-orange-600 mt-1">‚Üë 5% vs Q3</p>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-6 mb-6">
                    <!-- Pipeline Funnel -->
                    <div class="col-span-2 bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Sales Pipeline Funnel</h3>
                        <div class="chart-container">
                            <canvas id="pipelineFunnelChart"></canvas>
                        </div>
                    </div>

                    <!-- Pipeline Summary -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Pipeline Summary</h3>
                        <div id="pipelineSummary" class="space-y-3">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- At-Risk Deals -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è At-Risk Deals (Stalled > 30 Days)</h3>
                    <div id="atRiskDeals" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- PROCUREMENT TAB -->
            <div id="content-procurement" class="tab-content hidden">
                <!-- Procurement Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Open POs</h3>
                        <p class="text-3xl font-bold text-gray-800" id="openPOs">34</p>
                        <p class="text-sm text-blue-600 mt-1">$2.8M value</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">POs Received Today</h3>
                        <p class="text-3xl font-bold text-gray-800" id="posReceivedToday">8</p>
                        <p class="text-sm text-green-600 mt-1">$450K value</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Pending Approvals</h3>
                        <p class="text-3xl font-bold text-gray-800" id="pendingApprovals">12</p>
                        <p class="text-sm text-yellow-600 mt-1">$890K value</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Supplier Count</h3>
                        <p class="text-3xl font-bold text-gray-800" id="supplierCount">156</p>
                        <p class="text-sm text-purple-600 mt-1">12 active this month</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Avg Lead Time</h3>
                        <p class="text-3xl font-bold text-gray-800" id="avgLeadTime">14d</p>
                        <p class="text-sm text-orange-600 mt-1">‚Üì 2d vs last month</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- Procurement by Category -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Procurement by Category</h3>
                        <div class="chart-container">
                            <canvas id="procurementCategoryChart"></canvas>
                        </div>
                    </div>

                    <!-- Top Suppliers -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Suppliers by Spend</h3>
                        <div id="topSuppliers" class="space-y-3">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Pending Purchase Orders -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìã Pending Purchase Orders</h3>
                    <div id="pendingPOs" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- INVENTORY TAB -->
            <div id="content-inventory" class="tab-content hidden">
                <!-- Inventory Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Total SKUs</h3>
                        <p class="text-3xl font-bold text-gray-800" id="totalSKUs">1,245</p>
                        <p class="text-sm text-blue-600 mt-1">Across 8 warehouses</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Total Stock Value</h3>
                        <p class="text-3xl font-bold text-gray-800" id="stockValue">$8.5M</p>
                        <p class="text-sm text-green-600 mt-1">‚Üë 3% vs last month</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Low Stock Items</h3>
                        <p class="text-3xl font-bold text-gray-800" id="lowStockItems">18</p>
                        <p class="text-sm text-red-600 mt-1">Requires reorder</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Out of Stock</h3>
                        <p class="text-3xl font-bold text-gray-800" id="outOfStock">5</p>
                        <p class="text-sm text-yellow-600 mt-1">$125K backorder</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Inventory Turnover</h3>
                        <p class="text-3xl font-bold text-gray-800" id="invTurnover">4.2x</p>
                        <p class="text-sm text-purple-600 mt-1">Annual rate</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- Inventory by Category -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Inventory by Category</h3>
                        <div class="chart-container">
                            <canvas id="inventoryCategoryChart"></canvas>
                        </div>
                    </div>

                    <!-- Warehouse Distribution -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Warehouse Distribution</h3>
                        <div class="chart-container">
                            <canvas id="warehouseChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alerts -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è Low Stock Alerts</h3>
                    <div id="lowStockAlerts" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- FIN - AP TAB (Accounts Payable) -->
            <div id="content-finap" class="tab-content hidden">
                <!-- AP Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Total Payables</h3>
                        <p class="text-3xl font-bold text-gray-800" id="totalPayables">$3.2M</p>
                        <p class="text-sm text-red-600 mt-1">Outstanding balance</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Due This Week</h3>
                        <p class="text-3xl font-bold text-gray-800" id="dueThisWeek">$890K</p>
                        <p class="text-sm text-yellow-600 mt-1">15 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Overdue</h3>
                        <p class="text-3xl font-bold text-gray-800" id="overdueAP">$245K</p>
                        <p class="text-sm text-orange-600 mt-1">8 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Paid This Month</h3>
                        <p class="text-3xl font-bold text-gray-800" id="paidThisMonth">$1.8M</p>
                        <p class="text-sm text-green-600 mt-1">67 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Avg Days to Pay</h3>
                        <p class="text-3xl font-bold text-gray-800" id="avgDaysToPay">28d</p>
                        <p class="text-sm text-blue-600 mt-1">vs 30d terms</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- AP Aging Chart -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">AP Aging Summary</h3>
                        <div class="chart-container">
                            <canvas id="apAgingChart"></canvas>
                        </div>
                    </div>

                    <!-- Top Vendors by Payables -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Vendors by Outstanding</h3>
                        <div id="topVendorsAP" class="space-y-3">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Upcoming Payments -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí≥ Upcoming Payments Due</h3>
                    <div id="upcomingPayments" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- FIN - AR TAB (Accounts Receivable) -->
            <div id="content-finar" class="tab-content hidden">
                <!-- AR Metrics Row -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Total Receivables</h3>
                        <p class="text-3xl font-bold text-gray-800" id="totalReceivables">$5.8M</p>
                        <p class="text-sm text-green-600 mt-1">Outstanding balance</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Due This Week</h3>
                        <p class="text-3xl font-bold text-gray-800" id="arDueThisWeek">$1.2M</p>
                        <p class="text-sm text-blue-600 mt-1">28 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Overdue</h3>
                        <p class="text-3xl font-bold text-gray-800" id="overdueAR">$680K</p>
                        <p class="text-sm text-red-600 mt-1">23 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">Collected This Month</h3>
                        <p class="text-3xl font-bold text-gray-800" id="collectedThisMonth">$4.2M</p>
                        <p class="text-sm text-purple-600 mt-1">156 invoices</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500 metric-card">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">DSO</h3>
                        <p class="text-3xl font-bold text-gray-800" id="dsoValue">34d</p>
                        <p class="text-sm text-orange-600 mt-1">Days Sales Outstanding</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- AR Aging Chart -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">AR Aging Summary</h3>
                        <div class="chart-container">
                            <canvas id="arAgingChart"></canvas>
                        </div>
                    </div>

                    <!-- Top Customers by Receivables -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Customers by Outstanding</h3>
                        <div id="topCustomersAR" class="space-y-3">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Overdue Invoices -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è Overdue Invoices - Collection Required</h3>
                    <div id="overdueInvoices" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Voice Order Modal -->
    <div id="voiceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">üé§ Voice Order Creation</h3>
            <div class="mb-6">
                <div id="voiceStatus" class="text-center py-8">
                    <div class="w-20 h-20 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center">
                        <span class="text-4xl">üé§</span>
                    </div>
                    <p class="text-gray-600">Click "Start Recording" and speak your order</p>
                    <p class="text-sm text-gray-500 mt-2">Example: "Create a sales order for Disney, 500 tablets at $1,200 each"</p>
                </div>
                <div id="voiceTranscript" class="bg-gray-50 rounded-lg p-4 min-h-[100px] hidden">
                    <p class="text-sm text-gray-600 mb-2">Transcript:</p>
                    <p id="transcriptText" class="text-gray-800"></p>
                </div>
            </div>
            <div id="orderDraft" class="hidden mb-6">
                <h4 class="font-bold text-gray-800 mb-3">Review Order Draft:</h4>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div id="draftContent"></div>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="startVoiceRecording()" id="recordBtn" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                    Start Recording
                </button>
                <button onclick="approveOrder()" id="approveBtn" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium hidden">
                    Approve & Submit
                </button>
                <button onclick="closeVoiceModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-medium">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentTab = 'clevel';
        let voiceRecognition = null;
        let isRecording = false;

        // ============================================================
        // TAB CONFIGURATION - EDIT THESE VALUES TO CHANGE TAB NAMES
        // ============================================================
        const TAB_CONFIG = {
            clevel: {
                id: 'clevel',
                name: 'C-level Overview',
                icon: 'üìä',
                description: 'Executive summary and key metrics'
            },
            sales: {
                id: 'sales',
                name: 'Sales',
                icon: 'üí∞',
                description: 'Sales pipeline and performance'
            },
            procurement: {
                id: 'procurement',
                name: 'Procurement',
                icon: 'üõí',
                description: 'Procurement and purchasing'
            },
            inventory: {
                id: 'inventory',
                name: 'Inventory',
                icon: 'üì¶',
                description: 'Stock and inventory management'
            },
            finap: {
                id: 'finap',
                name: 'Fin - AP',
                icon: 'üí≥',
                description: 'Accounts Payable'
            },
            finar: {
                id: 'finar',
                name: 'Fin - AR',
                icon: 'üíµ',
                description: 'Accounts Receivable'
            }
        };
        // ============================================================

        // Store chart instances to prevent memory leaks
        let charts = {
            revenueTrend: null,
            regional: null,
            pipelineFunnel: null,
            productPerformance: null,
            salesPipeline: null,
            procurementChart: null,
            inventoryChart: null,
            apChart: null,
            arChart: null
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadDashboardData();
            initializeCharts();
            setupVoiceRecognition();

            // Refresh data every 30 seconds
            setInterval(loadDashboardData, 30000);
        });

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.remove('tab-active'));
            document.getElementById('content-' + tabName).classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
            currentTab = tabName;

            // Load tab-specific data based on new tab structure
            if (tabName === 'clevel') loadCLevelData();
            if (tabName === 'sales') loadSalesData();
            if (tabName === 'procurement') loadProcurementData();
            if (tabName === 'inventory') loadInventoryData();
            if (tabName === 'finap') loadFinAPData();
            if (tabName === 'finar') loadFinARData();
        }

        // Function to dynamically update tab names from TAB_CONFIG
        function updateTabNames() {
            Object.keys(TAB_CONFIG).forEach(key => {
                const tab = TAB_CONFIG[key];
                const tabButton = document.getElementById('tab-' + tab.id);
                if (tabButton) {
                    tabButton.innerHTML = `${tab.icon} ${tab.name}`;
                    // Re-add notification badge for inventory tab
                    if (tab.id === 'inventory') {
                        tabButton.innerHTML += ' <span class="notification-badge" id="inventoryNotif">0</span>';
                    }
                }
            });
        }

        async function loadDashboardData() {
            try {
                // C-Level Overview mock data
                const mockData = {
                    totalRevenue: 45200000,
                    revenueChange: 8.5,
                    openOrders: 156,
                    openOrdersValue: 4500000,
                    cashPosition: 12800000,
                    cashFlow: 890000,
                    inventoryValue: 8500000,
                    inventoryTurnover: 4.2,
                    profitMargin: 23.5,
                    marginChange: -1.2,
                    todayRevenue: 2300000,
                    quarterProgress: 87
                };

                // Update C-Level Overview metrics
                document.getElementById('totalRevenue').textContent = `$${(mockData.totalRevenue / 1000000).toFixed(1)}M`;
                document.getElementById('revenueChange').textContent = `‚Üë ${mockData.revenueChange}% vs last month`;
                document.getElementById('openOrders').textContent = mockData.openOrders;
                document.getElementById('openOrdersValue').textContent = `$${(mockData.openOrdersValue / 1000000).toFixed(1)}M`;
                document.getElementById('cashPosition').textContent = `$${(mockData.cashPosition / 1000000).toFixed(1)}M`;
                document.getElementById('cashFlow').textContent = `+$${(mockData.cashFlow / 1000).toFixed(0)}K this week`;
                document.getElementById('inventoryValue').textContent = `$${(mockData.inventoryValue / 1000000).toFixed(1)}M`;
                document.getElementById('inventoryTurnover').textContent = `${mockData.inventoryTurnover}x turnover`;
                document.getElementById('profitMargin').textContent = `${mockData.profitMargin}%`;
                document.getElementById('marginChange').textContent = `‚Üì ${Math.abs(mockData.marginChange)}% vs target`;

                // Update header metrics
                document.getElementById('headerRevenue').textContent = `$${(mockData.todayRevenue / 1000000).toFixed(1)}M`;
                document.getElementById('headerQuarterProgress').textContent = `${mockData.quarterProgress}%`;

                // Update inventory notification
                const invNotif = document.getElementById('inventoryNotif');
                if (invNotif) invNotif.textContent = '18';

                loadTopPerformers();
                loadCriticalAlerts();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function loadCLevelData() {
            // C-Level data is loaded by default in loadDashboardData
            console.log('Loading C-Level Overview data...');
        }

        function loadTopPerformers() {
            // Executive Alerts for C-Level Overview
            const alerts = [
                { title: 'Sales Target', desc: '87% of Q4 target achieved', status: 'on-track', icon: 'üí∞' },
                { title: 'Cash Flow', desc: 'Positive $890K this week', status: 'good', icon: 'üíµ' },
                { title: 'Inventory Alert', desc: '18 items below reorder point', status: 'warning', icon: 'üì¶' }
            ];

            const statusColors = {
                'on-track': 'blue',
                'good': 'green',
                'warning': 'yellow'
            };

            const html = alerts.map(a => `
                <div class="flex items-center justify-between p-3 bg-${statusColors[a.status]}-50 border-l-4 border-${statusColors[a.status]}-500 rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 text-sm">${a.icon} ${a.title}</p>
                        <p class="text-xs text-gray-600">${a.desc}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('topPerformers').innerHTML = html;
        }

        function loadCriticalAlerts() {
            const alerts = [
                { title: 'AR Overdue', desc: '$680K in overdue receivables (23 invoices)', priority: 'high' },
                { title: 'Low Inventory', desc: '5 items out of stock, $125K backorder impact', priority: 'high' },
                { title: 'AP Due This Week', desc: '$890K in payments due within 7 days', priority: 'medium' },
                { title: 'Large Deal at Risk', desc: 'Disney deal ($500K) stalled for 45 days', priority: 'medium' }
            ];

            const html = alerts.map(a => `
                <div class="bg-${a.priority === 'high' ? 'red' : 'orange'}-50 border-l-4 border-${a.priority === 'high' ? 'red' : 'orange'}-500 rounded-lg p-3">
                    <p class="font-semibold text-${a.priority === 'high' ? 'red' : 'orange'}-800 text-sm">${a.title}</p>
                    <p class="text-xs text-${a.priority === 'high' ? 'red' : 'orange'}-600 mt-1">${a.desc}</p>
                </div>
            `).join('');

            document.getElementById('criticalAlerts').innerHTML = html;
        }

        function initializeCharts() {
            try {
                // Revenue Trend Chart
                const revenueTrendCtx = document.getElementById('revenueTrendChart');
                if (revenueTrendCtx) {
                    if (charts.revenueTrend) charts.revenueTrend.destroy();
                    charts.revenueTrend = new Chart(revenueTrendCtx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Revenue',
                                data: [2.1, 2.3, 2.0, 2.5, 2.8, 1.9, 2.3],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value + 'M';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // Department Performance Chart (for C-Level Overview)
                const regionalCtx = document.getElementById('regionalChart');
                if (regionalCtx) {
                    if (charts.regional) charts.regional.destroy();
                    charts.regional = new Chart(regionalCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Sales', 'Procurement', 'Inventory', 'Fin - AP', 'Fin - AR'],
                            datasets: [{
                                label: 'Performance vs Target',
                                data: [87, 92, 78, 95, 82],
                                backgroundColor: [
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(251, 146, 60, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        }

        function initializePipelineChart() {
            try {
                const pipelineCtx = document.getElementById('pipelineFunnelChart');
                if (pipelineCtx) {
                    if (charts.pipelineFunnel) charts.pipelineFunnel.destroy();
                    charts.pipelineFunnel = new Chart(pipelineCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Lead', 'Qualified', 'Proposal', 'Negotiation', 'Closed Won'],
                            datasets: [{
                                label: 'Deal Count',
                                data: [145, 98, 67, 42, 28],
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(34, 197, 94, 0.7)',
                                    'rgba(251, 191, 36, 0.7)',
                                    'rgba(251, 146, 60, 0.7)',
                                    'rgba(16, 185, 129, 0.9)'
                                ],
                                borderColor: [
                                    'rgb(59, 130, 246)',
                                    'rgb(34, 197, 94)',
                                    'rgb(251, 191, 36)',
                                    'rgb(251, 146, 60)',
                                    'rgb(16, 185, 129)'
                                ],
                                borderWidth: 2
                            }, {
                                label: 'Total Value',
                                data: [18.5, 14.2, 10.8, 7.5, 5.2],
                                backgroundColor: 'rgba(168, 85, 247, 0.3)',
                                borderColor: 'rgb(168, 85, 247)',
                                borderWidth: 2,
                                type: 'line',
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.datasetIndex === 1) {
                                                label += '$' + context.parsed.y + 'M';
                                            } else {
                                                label += context.parsed.y + ' deals';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Deal Count'
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    beginAtZero: true,
                                    grid: {
                                        drawOnChartArea: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Value ($M)'
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value + 'M';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing pipeline chart:', error);
            }
        }

        function initializeProductChart() {
            try {
                const productCtx = document.getElementById('productPerformanceChart');
                if (productCtx) {
                    if (charts.productPerformance) charts.productPerformance.destroy();
                    charts.productPerformance = new Chart(productCtx, {
                        type: 'bar',
                        data: {
                            labels: [
                                'Enterprise Software License',
                                'Professional Services',
                                'Cloud Subscription',
                                'Hardware - Tablets',
                                'Support & Maintenance',
                                'Training Services',
                                'Custom Development',
                                'Hardware - Servers'
                            ],
                            datasets: [{
                                label: 'Revenue ($M)',
                                data: [4.2, 3.8, 3.5, 2.9, 2.1, 1.8, 1.5, 1.2],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1
                            }, {
                                label: 'Units Sold',
                                data: [85, 120, 450, 890, 340, 95, 42, 156],
                                backgroundColor: 'rgba(34, 197, 94, 0.6)',
                                borderColor: 'rgb(34, 197, 94)',
                                borderWidth: 1,
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            indexAxis: 'y',
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.datasetIndex === 0) {
                                                label += '$' + context.parsed.x + 'M';
                                            } else {
                                                label += context.parsed.x + ' units';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    display: true,
                                    position: 'bottom',
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Revenue ($M)'
                                    }
                                },
                                x1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'top',
                                    beginAtZero: true,
                                    grid: {
                                        drawOnChartArea: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Units Sold'
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing product chart:', error);
            }
        }

        // Voice Recognition
        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                voiceRecognition = new webkitSpeechRecognition();
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
                voiceRecognition.lang = 'en-US';

                voiceRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleVoiceCommand(transcript);
                };

                voiceRecognition.onerror = function(event) {
                    console.error('Voice recognition error:', event.error);
                    alert('Voice recognition error: ' + event.error);
                };
            }
        }

        function startVoiceQuery() {
            if (voiceRecognition) {
                const btn = document.getElementById('voiceBtn');
                btn.textContent = 'üé§ Listening...';
                btn.classList.add('voice-recording');
                voiceRecognition.start();

                voiceRecognition.onend = function() {
                    btn.textContent = 'üé§ Voice Command';
                    btn.classList.remove('voice-recording');
                };
            } else {
                alert('Voice recognition not supported in this browser');
            }
        }

        function handleVoiceCommand(transcript) {
            document.getElementById('aiQueryInput').value = transcript;
            askAI();
        }

        async function askAI() {
            const input = document.getElementById('aiQueryInput');
            const query = input.value.trim();
            if (!query) return;

            const chatMessages = document.getElementById('aiChatMessages');

            // User message
            chatMessages.innerHTML += `
                <div class="flex justify-end mb-3">
                    <div class="bg-blue-500 text-white rounded-lg p-3 max-w-[85%]">
                        <p class="text-sm">${query}</p>
                    </div>
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;
            input.value = '';

            // Loading indicator
            chatMessages.innerHTML += `
                <div id="loading" class="flex justify-start mb-3">
                    <div class="bg-gray-200 rounded-lg p-3">
                        <p class="text-sm text-gray-600">ü§î Thinking...</p>
                    </div>
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                setTimeout(() => {
                    document.getElementById('loading')?.remove();
                    const response = generateMockAIResponse(query);
                    chatMessages.innerHTML += `
                        <div class="flex justify-start mb-3">
                            <div class="bg-white border border-gray-200 rounded-lg p-3 max-w-[85%]">
                                <p class="text-sm text-gray-700">${response}</p>
                            </div>
                        </div>
                    `;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500);
            } catch (error) {
                document.getElementById('loading')?.remove();
                console.error('Error asking AI:', error);
            }
        }

        function askQuick(query) {
            document.getElementById('aiQueryInput').value = query;
            askAI();
        }

        function generateMockAIResponse(query) {
            const lowerQuery = query.toLowerCase();
            if (lowerQuery.includes('orders') && lowerQuery.includes('today')) {
                return "You received 52 orders today totaling $2.3M, which is 12% higher than yesterday. 47 orders are already fulfilled, and 23 are pending.";
            } else if (lowerQuery.includes('pending') || lowerQuery.includes('100k')) {
                return "You have 5 pending orders over $100K:\n1. Disney - $500K\n2. ABC Corp - $280K\n3. XYZ Ltd - $150K\n4. Tech Inc - $120K\n5. Global Co - $110K";
            } else if (lowerQuery.includes('region')) {
                return "North America: $5.8M (leading)\nEMEA: $3.2M\nAPAC: $2.9M\nLATAM: $1.4M (underperforming, 35% below target)";
            } else if (lowerQuery.includes('compare') && lowerQuery.includes('quarter')) {
                return "Q4 2025 vs Q3 2025:\n- Revenue: $45.2M (+8.5%)\n- Orders: 1,245 (+12%)\n- Win Rate: 42% (-3%)\n- Average Deal Size: $36.3K (+5%)";
            } else if (lowerQuery.includes('create') || lowerQuery.includes('order')) {
                return "I'll help you create an order. Use the 'Create Order (Voice)' button to speak your order details.";
            } else {
                return "I understand your question about: \"" + query + "\". Let me analyze the sales data and provide insights.";
            }
        }

        // Voice Order Modal
        function startVoiceOrder() {
            document.getElementById('voiceModal').classList.remove('hidden');
        }

        function closeVoiceModal() {
            document.getElementById('voiceModal').classList.add('hidden');
            document.getElementById('voiceTranscript').classList.add('hidden');
            document.getElementById('orderDraft').classList.add('hidden');
            document.getElementById('approveBtn').classList.add('hidden');
            isRecording = false;
        }

        function startVoiceRecording() {
            if (voiceRecognition && !isRecording) {
                isRecording = true;
                const btn = document.getElementById('recordBtn');
                btn.textContent = 'üé§ Listening...';
                btn.classList.add('voice-recording');

                voiceRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('voiceTranscript').classList.remove('hidden');
                    document.getElementById('transcriptText').textContent = transcript;
                    processVoiceOrder(transcript);
                };

                voiceRecognition.onend = function() {
                    btn.textContent = 'Start Recording';
                    btn.classList.remove('voice-recording');
                    isRecording = false;
                };

                voiceRecognition.start();
            }
        }

        async function processVoiceOrder(transcript) {
            setTimeout(() => {
                const orderDraft = {
                    customer: 'Disney',
                    product: 'Tablets',
                    quantity: 500,
                    price: 1200,
                    total: 600000
                };

                document.getElementById('orderDraft').classList.remove('hidden');
                document.getElementById('draftContent').innerHTML = `
                    <div class="space-y-2">
                        <p><span class="font-semibold">Customer:</span> ${orderDraft.customer}</p>
                        <p><span class="font-semibold">Product:</span> ${orderDraft.product}</p>
                        <p><span class="font-semibold">Quantity:</span> ${orderDraft.quantity}</p>
                        <p><span class="font-semibold">Unit Price:</span> $${orderDraft.price.toLocaleString()}</p>
                        <p><span class="font-semibold text-green-600">Total:</span> <span class="text-green-600 text-xl font-bold">$${orderDraft.total.toLocaleString()}</span></p>
                    </div>
                `;
                document.getElementById('approveBtn').classList.remove('hidden');
            }, 1000);
        }

        async function approveOrder() {
            alert('Order submitted successfully! Order #SO-12345 created.');
            closeVoiceModal();
        }

        function generateReport() {
            alert('Generating sales report...');
        }

        function loadPipelineData() {
            console.log('Loading pipeline data...');
            initializePipelineChart();
            loadPipelineSummary();
            loadAtRiskDeals();
        }

        function loadPipelineSummary() {
            const summary = [
                { stage: 'Lead', count: 145, value: 18.5, color: 'blue' },
                { stage: 'Qualified', count: 98, value: 14.2, color: 'green' },
                { stage: 'Proposal', count: 67, value: 10.8, color: 'yellow' },
                { stage: 'Negotiation', count: 42, value: 7.5, color: 'orange' },
                { stage: 'Closed Won', count: 28, value: 5.2, color: 'emerald' }
            ];

            const html = summary.map(s => `
                <div class="bg-${s.color}-50 border-l-4 border-${s.color}-500 rounded-lg p-3">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold text-gray-800 text-sm">${s.stage}</p>
                            <p class="text-xs text-gray-600 mt-1">${s.count} deals</p>
                        </div>
                        <p class="text-lg font-bold text-${s.color}-600">$${s.value}M</p>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('pipelineSummary');
            if (element) element.innerHTML = html;
        }

        function loadAtRiskDeals() {
            const deals = [
                { company: 'Disney Corporation', amount: 500000, days: 45, rep: 'Sarah Johnson' },
                { company: 'Tech Giants Inc', amount: 280000, days: 38, rep: 'Michael Chen' },
                { company: 'Global Retail Co', amount: 150000, days: 42, rep: 'Emily Rodriguez' }
            ];

            const html = deals.map(d => `
                <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-gray-800">${d.company}</h4>
                        <span class="text-2xl font-bold text-red-600">$${(d.amount / 1000).toFixed(0)}K</span>
                    </div>
                    <p class="text-sm text-gray-600">üî¥ Stalled for ${d.days} days | Rep: ${d.rep}</p>
                    <div class="mt-3 flex gap-2">
                        <button class="px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">Alert Rep</button>
                        <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300">View Details</button>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('atRiskDeals');
            if (element) element.innerHTML = html;
        }

        function loadOrdersData() {
            console.log('Loading orders data...');
            const orders = [
                { number: 'SO-2025-1001', customer: 'Disney', date: '2025-11-05', amount: 49100, status: 'fulfilled' },
                { number: 'SO-2025-1002', customer: 'Tech Giants', date: '2025-11-05', amount: 125000, status: 'pending' },
                { number: 'SO-2025-1003', customer: 'Global Retail', date: '2025-11-04', amount: 78500, status: 'fulfilled' }
            ];

            const statusColors = {
                'fulfilled': 'green',
                'pending': 'yellow',
                'partial': 'orange',
                'cancelled': 'red'
            };

            const html = `
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Order #</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Customer</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Date</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Amount</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders.map(o => `
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="px-4 py-3 text-sm font-medium text-gray-800">${o.number}</td>
                                    <td class="px-4 py-3 text-sm text-gray-700">${o.customer}</td>
                                    <td class="px-4 py-3 text-sm text-gray-600">${o.date}</td>
                                    <td class="px-4 py-3 text-sm font-semibold text-gray-800">$${o.amount.toLocaleString()}</td>
                                    <td class="px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-${statusColors[o.status]}-100 text-${statusColors[o.status]}-800">
                                            ${o.status}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            const element = document.getElementById('ordersTable');
            if (element) element.innerHTML = html;
        }

        function loadCustomersData() {
            console.log('Loading customers data...');
            const topCustomers = [
                { name: 'Disney Corporation', revenue: 2500000, orders: 45, status: 'active' },
                { name: 'Tech Giants Inc', revenue: 3200000, orders: 52, status: 'active' },
                { name: 'Global Retail Co', revenue: 1800000, orders: 38, status: 'active' }
            ];

            const atRisk = [
                { name: 'ABC Corp', lastOrder: '45 days ago', revenue: 450000 },
                { name: 'XYZ Ltd', lastOrder: '60 days ago', revenue: 320000 }
            ];

            const topHtml = topCustomers.map((c, i) => `
                <div class="flex items-center justify-between p-3 ${i === 0 ? 'bg-blue-50 border-l-4 border-blue-500' : 'bg-gray-50'} rounded-lg mb-3">
                    <div>
                        <p class="font-semibold text-gray-800">${i + 1}. ${c.name}</p>
                        <p class="text-xs text-gray-600">${c.orders} orders | Active</p>
                    </div>
                    <p class="text-lg font-bold text-green-600">$${(c.revenue / 1000).toFixed(0)}K</p>
                </div>
            `).join('');

            const riskHtml = atRisk.map(c => `
                <div class="bg-orange-50 border-l-4 border-orange-500 rounded-lg p-3 mb-3">
                    <p class="font-semibold text-orange-800">${c.name}</p>
                    <p class="text-xs text-orange-600 mt-1">Last order: ${c.lastOrder}</p>
                    <p class="text-xs text-gray-600">Lifetime value: $${(c.revenue / 1000).toFixed(0)}K</p>
                    <button class="mt-2 px-3 py-1 bg-orange-600 text-white text-xs rounded hover:bg-orange-700">Re-engage</button>
                </div>
            `).join('');

            const topElement = document.getElementById('topCustomers');
            const riskElement = document.getElementById('atRiskCustomers');

            if (topElement) topElement.innerHTML = topHtml;
            if (riskElement) riskElement.innerHTML = riskHtml;
        }

        function loadProductsData() {
            console.log('Loading products data...');
            initializeProductChart();
        }

        function loadInsightsData() {
            console.log('Loading insights data...');

            const insights = [
                { title: 'Revenue Trend', desc: 'Revenue is up 12% this week compared to last week', trend: 'up' },
                { title: 'Win Rate', desc: 'Win rate decreased by 3% from last month', trend: 'down' },
                { title: 'Pipeline Health', desc: 'Pipeline value increased to $12.5M (+8%)', trend: 'up' }
            ];

            const recommendations = [
                { title: 'Focus on LATAM', desc: 'LATAM region is 35% behind target. Consider additional resources.' },
                { title: 'Follow up on stalled deals', desc: '8 deals have been stalled for >30 days. Total value: $1.8M' },
                { title: 'Upsell opportunity', desc: 'Disney has purchased tablets. Consider selling support packages.' }
            ];

            const insightsHtml = insights.map(i => `
                <div class="bg-${i.trend === 'up' ? 'green' : 'orange'}-50 border-l-4 border-${i.trend === 'up' ? 'green' : 'orange'}-500 rounded-lg p-4 mb-3">
                    <h4 class="font-bold text-gray-800 text-sm">${i.title}</h4>
                    <p class="text-xs text-gray-600 mt-1">${i.desc}</p>
                    <span class="text-${i.trend === 'up' ? 'green' : 'orange'}-600 text-lg">${i.trend === 'up' ? '‚Üë' : '‚Üì'}</span>
                </div>
            `).join('');

            const recsHtml = recommendations.map(r => `
                <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-3">
                    <h4 class="font-bold text-gray-800 text-sm">${r.title}</h4>
                    <p class="text-xs text-gray-600 mt-1">${r.desc}</p>
                    <button class="mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">Take Action</button>
                </div>
            `).join('');

            const insightsElement = document.getElementById('performanceInsights');
            const recsElement = document.getElementById('recommendations');

            if (insightsElement) insightsElement.innerHTML = insightsHtml;
            if (recsElement) recsElement.innerHTML = recsHtml;
        }

        function filterOrders(status) {
            console.log('Filtering orders by:', status);
        }

        function updateRevenueTrend(period) {
            console.log('Updating revenue trend for period:', period);
        }

        // ============================================================
        // NEW TAB DATA LOADING FUNCTIONS
        // ============================================================

        function loadSalesData() {
            console.log('Loading Sales data...');
            initializePipelineChart();
            loadPipelineSummary();
            loadAtRiskDeals();
        }

        function loadProcurementData() {
            console.log('Loading Procurement data...');
            initializeProcurementChart();
            loadTopSuppliers();
            loadPendingPOs();
        }

        function initializeProcurementChart() {
            try {
                const ctx = document.getElementById('procurementCategoryChart');
                if (ctx) {
                    if (charts.procurementChart) charts.procurementChart.destroy();
                    charts.procurementChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Raw Materials', 'Equipment', 'Services', 'Supplies', 'IT/Software'],
                            datasets: [{
                                data: [35, 25, 20, 12, 8],
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(251, 146, 60, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: {
                                legend: { position: 'right' }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing procurement chart:', error);
            }
        }

        function loadTopSuppliers() {
            const suppliers = [
                { name: 'Acme Manufacturing', spend: 1200000, orders: 45 },
                { name: 'Global Tech Solutions', spend: 890000, orders: 32 },
                { name: 'Premier Materials Inc', spend: 650000, orders: 28 },
                { name: 'Quality Components Ltd', spend: 450000, orders: 19 }
            ];

            const html = suppliers.map((s, i) => `
                <div class="flex items-center justify-between p-3 ${i === 0 ? 'bg-blue-50 border-l-4 border-blue-500' : 'bg-gray-50'} rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 text-sm">${i + 1}. ${s.name}</p>
                        <p class="text-xs text-gray-600">${s.orders} orders this year</p>
                    </div>
                    <p class="text-lg font-bold text-blue-600">$${(s.spend / 1000).toFixed(0)}K</p>
                </div>
            `).join('');

            const element = document.getElementById('topSuppliers');
            if (element) element.innerHTML = html;
        }

        function loadPendingPOs() {
            const pos = [
                { number: 'PO-2025-0456', supplier: 'Acme Manufacturing', amount: 125000, dueDate: '2025-12-20', status: 'pending' },
                { number: 'PO-2025-0457', supplier: 'Global Tech Solutions', amount: 89000, dueDate: '2025-12-18', status: 'approved' },
                { number: 'PO-2025-0458', supplier: 'Premier Materials', amount: 67000, dueDate: '2025-12-22', status: 'pending' }
            ];

            const html = pos.map(p => `
                <div class="bg-gray-50 border-l-4 border-${p.status === 'approved' ? 'green' : 'yellow'}-500 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <p class="font-bold text-gray-800">${p.number}</p>
                            <p class="text-sm text-gray-600">${p.supplier}</p>
                        </div>
                        <span class="text-xl font-bold text-gray-800">$${(p.amount / 1000).toFixed(0)}K</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-xs text-gray-500">Due: ${p.dueDate}</p>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-${p.status === 'approved' ? 'green' : 'yellow'}-100 text-${p.status === 'approved' ? 'green' : 'yellow'}-800">${p.status}</span>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('pendingPOs');
            if (element) element.innerHTML = html;
        }

        function loadInventoryData() {
            console.log('Loading Inventory data...');
            initializeInventoryCharts();
            loadLowStockAlerts();
        }

        function initializeInventoryCharts() {
            try {
                // Inventory by Category Chart
                const catCtx = document.getElementById('inventoryCategoryChart');
                if (catCtx) {
                    if (charts.inventoryChart) charts.inventoryChart.destroy();
                    charts.inventoryChart = new Chart(catCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Electronics', 'Raw Materials', 'Finished Goods', 'Packaging', 'Spare Parts'],
                            datasets: [{
                                data: [32, 28, 22, 10, 8],
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(251, 146, 60, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: { legend: { position: 'right' } }
                        }
                    });
                }

                // Warehouse Distribution Chart
                const whCtx = document.getElementById('warehouseChart');
                if (whCtx) {
                    new Chart(whCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Main WH', 'East Coast', 'West Coast', 'Central', 'International'],
                            datasets: [{
                                label: 'Stock Value ($M)',
                                data: [3.2, 1.8, 1.5, 1.2, 0.8],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { callback: v => '$' + v + 'M' }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing inventory charts:', error);
            }
        }

        function loadLowStockAlerts() {
            const items = [
                { sku: 'SKU-1234', name: 'Widget A', current: 12, reorder: 50, status: 'critical' },
                { sku: 'SKU-2345', name: 'Component B', current: 0, reorder: 100, status: 'out' },
                { sku: 'SKU-3456', name: 'Part C', current: 25, reorder: 75, status: 'low' },
                { sku: 'SKU-4567', name: 'Material D', current: 0, reorder: 200, status: 'out' }
            ];

            const statusConfig = {
                'out': { color: 'red', label: 'Out of Stock' },
                'critical': { color: 'red', label: 'Critical' },
                'low': { color: 'yellow', label: 'Low Stock' }
            };

            const html = items.map(i => `
                <div class="bg-${statusConfig[i.status].color}-50 border-l-4 border-${statusConfig[i.status].color}-500 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <p class="font-bold text-gray-800">${i.name}</p>
                            <p class="text-xs text-gray-600">${i.sku}</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-${statusConfig[i.status].color}-100 text-${statusConfig[i.status].color}-800">${statusConfig[i.status].label}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-gray-600">Current: <span class="font-bold">${i.current}</span> | Reorder Point: ${i.reorder}</p>
                        <button class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">Create PO</button>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('lowStockAlerts');
            if (element) element.innerHTML = html;
        }

        function loadFinAPData() {
            console.log('Loading Fin - AP data...');
            initializeAPChart();
            loadTopVendorsAP();
            loadUpcomingPayments();
        }

        function initializeAPChart() {
            try {
                const ctx = document.getElementById('apAgingChart');
                if (ctx) {
                    if (charts.apChart) charts.apChart.destroy();
                    charts.apChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Current', '1-30 Days', '31-60 Days', '61-90 Days', '90+ Days'],
                            datasets: [{
                                label: 'Amount ($K)',
                                data: [1800, 890, 320, 145, 45],
                                backgroundColor: [
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(251, 146, 60, 0.8)',
                                    'rgba(239, 68, 68, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { callback: v => '$' + v + 'K' }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing AP chart:', error);
            }
        }

        function loadTopVendorsAP() {
            const vendors = [
                { name: 'Acme Manufacturing', amount: 450000, invoices: 12 },
                { name: 'Global Tech Solutions', amount: 320000, invoices: 8 },
                { name: 'Premier Materials Inc', amount: 280000, invoices: 15 },
                { name: 'Quality Components Ltd', amount: 190000, invoices: 6 }
            ];

            const html = vendors.map((v, i) => `
                <div class="flex items-center justify-between p-3 ${i === 0 ? 'bg-red-50 border-l-4 border-red-500' : 'bg-gray-50'} rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 text-sm">${v.name}</p>
                        <p class="text-xs text-gray-600">${v.invoices} invoices</p>
                    </div>
                    <p class="text-lg font-bold text-red-600">$${(v.amount / 1000).toFixed(0)}K</p>
                </div>
            `).join('');

            const element = document.getElementById('topVendorsAP');
            if (element) element.innerHTML = html;
        }

        function loadUpcomingPayments() {
            const payments = [
                { vendor: 'Acme Manufacturing', invoice: 'INV-2025-1234', amount: 125000, dueDate: '2025-12-18', daysUntil: 3 },
                { vendor: 'Global Tech Solutions', invoice: 'INV-2025-1235', amount: 89000, dueDate: '2025-12-20', daysUntil: 5 },
                { vendor: 'Premier Materials', invoice: 'INV-2025-1236', amount: 67000, dueDate: '2025-12-22', daysUntil: 7 }
            ];

            const html = payments.map(p => `
                <div class="bg-${p.daysUntil <= 3 ? 'yellow' : 'gray'}-50 border-l-4 border-${p.daysUntil <= 3 ? 'yellow' : 'gray'}-500 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <p class="font-bold text-gray-800">${p.vendor}</p>
                            <p class="text-xs text-gray-600">${p.invoice}</p>
                        </div>
                        <span class="text-xl font-bold text-gray-800">$${(p.amount / 1000).toFixed(0)}K</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-xs text-gray-500">Due: ${p.dueDate} (${p.daysUntil} days)</p>
                        <button class="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700">Pay Now</button>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('upcomingPayments');
            if (element) element.innerHTML = html;
        }

        function loadFinARData() {
            console.log('Loading Fin - AR data...');
            initializeARChart();
            loadTopCustomersAR();
            loadOverdueInvoices();
        }

        function initializeARChart() {
            try {
                const ctx = document.getElementById('arAgingChart');
                if (ctx) {
                    if (charts.arChart) charts.arChart.destroy();
                    charts.arChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Current', '1-30 Days', '31-60 Days', '61-90 Days', '90+ Days'],
                            datasets: [{
                                label: 'Amount ($K)',
                                data: [3200, 1450, 680, 320, 150],
                                backgroundColor: [
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(251, 146, 60, 0.8)',
                                    'rgba(239, 68, 68, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { callback: v => '$' + v + 'K' }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing AR chart:', error);
            }
        }

        function loadTopCustomersAR() {
            const customers = [
                { name: 'Disney Corporation', amount: 680000, invoices: 8 },
                { name: 'Tech Giants Inc', amount: 520000, invoices: 12 },
                { name: 'Global Retail Co', amount: 380000, invoices: 6 },
                { name: 'ABC Industries', amount: 290000, invoices: 9 }
            ];

            const html = customers.map((c, i) => `
                <div class="flex items-center justify-between p-3 ${i === 0 ? 'bg-green-50 border-l-4 border-green-500' : 'bg-gray-50'} rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 text-sm">${c.name}</p>
                        <p class="text-xs text-gray-600">${c.invoices} invoices</p>
                    </div>
                    <p class="text-lg font-bold text-green-600">$${(c.amount / 1000).toFixed(0)}K</p>
                </div>
            `).join('');

            const element = document.getElementById('topCustomersAR');
            if (element) element.innerHTML = html;
        }

        function loadOverdueInvoices() {
            const invoices = [
                { customer: 'ABC Industries', invoice: 'INV-2025-0890', amount: 125000, daysOverdue: 45, status: 'critical' },
                { customer: 'XYZ Corporation', invoice: 'INV-2025-0891', amount: 89000, daysOverdue: 32, status: 'warning' },
                { customer: 'Tech Solutions Ltd', invoice: 'INV-2025-0892', amount: 67000, daysOverdue: 15, status: 'warning' }
            ];

            const html = invoices.map(i => `
                <div class="bg-${i.status === 'critical' ? 'red' : 'orange'}-50 border-l-4 border-${i.status === 'critical' ? 'red' : 'orange'}-500 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <p class="font-bold text-gray-800">${i.customer}</p>
                            <p class="text-xs text-gray-600">${i.invoice}</p>
                        </div>
                        <span class="text-xl font-bold text-${i.status === 'critical' ? 'red' : 'orange'}-600">$${(i.amount / 1000).toFixed(0)}K</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-xs text-${i.status === 'critical' ? 'red' : 'orange'}-600 font-semibold">${i.daysOverdue} days overdue</p>
                        <div class="flex gap-2">
                            <button class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">Send Reminder</button>
                            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300">Call</button>
                        </div>
                    </div>
                </div>
            `).join('');

            const element = document.getElementById('overdueInvoices');
            if (element) element.innerHTML = html;
        }

        // Rename loadPipelineData to loadSalesData for compatibility
        function loadPipelineData() {
            loadSalesData();
        }
    </script>
</body>
</html>
